<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Security Learning - Sonu Kumar</title>
    <link rel="stylesheet" href="../tutorial-styles.css">
</head>
<body class="page-spring">
    <header>
        <div class="container">
            <div class="hero">
                <h1>Spring Security Framework</h1>
                <p>Master Authentication & Authorization for Enterprise Applications</p>
            </div>
        </div>
    </header>
    <nav></nav>
    <script>window.activePage = 'spring';</script>
    <script src="../menu.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const codeBlocks = document.querySelectorAll('pre code');
            codeBlocks.forEach(block => {
                highlightJava(block);
            });
            updateActiveNav();
        });
        
        function highlightJava(element) {
            let code = element.textContent;
            
            code = code.replace(/\b(public|private|protected|static|final|class|interface|extends|implements|import|package|void|int|String|boolean|double|float|long|short|byte|char|if|else|for|while|do|switch|case|default|break|continue|return|try|catch|finally|throw|throws|new|this|super|null|true|false|abstract|synchronized|volatile|transient|native|strictfp|enum|assert|@Configuration|@EnableWebSecurity|@Service|@Component|@Autowired|@Value|@Entity|@Override|@Bean)\b/g, '<span class="keyword">$1</span>');
            
            code = code.replace(/"([^"]*)"/g, '<span class="string">"$1"</span>');
            code = code.replace(/'([^']*)'/g, '<span class="string">\'$1\'</span>');
            
            code = code.replace(/\/\/.*$/gm, '<span class="comment">$&</span>');
            code = code.replace(/\/\*[\s\S]*?\*\//g, '<span class="comment">$&</span>');
            
            code = code.replace(/\b\d+(\.\d+)?[fLdF]?\b/g, '<span class="number">$&</span>');
            
            code = code.replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/g, '<span class="method">$1</span>(');
            
            code = code.replace(/\b[A-Z][a-zA-Z0-9_]*\b/g, '<span class="class">$&</span>');
            
            element.innerHTML = code;
        }
        
        // Active navigation highlighting
        function updateActiveNav() {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.toc-nav a');
            
            let currentSection = '';
            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                if (rect.top <= 100) {
                    currentSection = section.id;
                }
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + currentSection) {
                    link.classList.add('active');
                }
            });
        }
        
        window.addEventListener('scroll', updateActiveNav);
    </script>
    
    <div class="container">
        <div class="content-with-sidebar">
            <aside class="sidebar-toc">
                <div class="toc-header">
                    <h2>üìö Spring Security Topics</h2>
                </div>
                <nav class="toc-nav">
                    <ul>
                        <li><a href="#overview">Security Overview</a></li>
                        <li><a href="#authentication">Authentication</a></li>
                        <li><a href="#jwt">JWT Security</a></li>
                        <li><a href="#interview">Interview Questions</a></li>
                    </ul>
                </nav>
            </aside>

            <div class="main-content">
            <div class="topic">

                <section id="overview" class="section">
                    <h2>üöÄ Spring Security Overview</h2>
                    
                    <div class="subsection">
                        <h3>What is Spring Security?</h3>
                        <p><strong>Definition:</strong> Spring Security is a comprehensive security framework that provides authentication, authorization, and protection against common attacks for Java applications.</p>
                        
                        <h4>Key Features:</h4>
                        <ul>
                            <li><strong>Authentication:</strong> Verify user identity</li>
                            <li><strong>Authorization:</strong> Control access to resources</li>
                            <li><strong>Protection:</strong> CSRF, session fixation, clickjacking protection</li>
                            <li><strong>Integration:</strong> LDAP, OAuth2, SAML support</li>
                            <li><strong>Method Security:</strong> Secure methods with annotations</li>
                            <li><strong>Customizable:</strong> Highly configurable and extensible</li>
                        </ul>
                        
                        <h4>Basic Configuration:</h4>
                        <div class="code-block">
                            <pre><code>@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(authz -> authz
                .requestMatchers("/public/**").permitAll()
                .requestMatchers("/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .formLogin(form -> form
                .loginPage("/login")
                .defaultSuccessUrl("/dashboard")
                .permitAll()
            )
            .logout(logout -> logout
                .logoutSuccessUrl("/login?logout")
                .permitAll()
            );
        
        return http.build();
    }
    
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}</code></pre>
                        </div>
                    </div>
                </section>

                <section id="authentication" class="section">
                    <h2>üîê Authentication</h2>
                    
                    <div class="subsection">
                        <h3>User Details Service</h3>
                        <div class="code-block">
                            <pre><code>@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true)
    private String username;
    
    private String password;
    
    private boolean enabled = true;
    
    @Enumerated(EnumType.STRING)
    private Set<Role> roles = new HashSet<>();
    
    // Constructors, getters, setters
}

@Service
public class CustomUserDetailsService implements UserDetailsService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Override
    @Transactional(readOnly = true)
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        User user = userRepository.findByUsername(username)
                .orElseThrow(() -> new UsernameNotFoundException("User not found: " + username));
        
        return org.springframework.security.core.userdetails.User.builder()
                .username(user.getUsername())
                .password(user.getPassword())
                .authorities(getAuthorities(user.getRoles()))
                .accountExpired(false)
                .accountLocked(false)
                .credentialsExpired(false)
                .disabled(!user.isEnabled())
                .build();
    }
    
    private Collection<? extends GrantedAuthority> getAuthorities(Set<Role> roles) {
        return roles.stream()
                .map(role -> new SimpleGrantedAuthority("ROLE_" + role.name()))
                .collect(Collectors.toList());
    }
}</code></pre>
                        </div>
                        
                        <h3>Custom Authentication Provider</h3>
                        <div class="code-block">
                            <pre><code>@Component
public class CustomAuthenticationProvider implements AuthenticationProvider {
    
    @Autowired
    private CustomUserDetailsService userDetailsService;
    
    @Autowired
    private PasswordEncoder passwordEncoder;
    
    @Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        String username = authentication.getName();
        String password = authentication.getCredentials().toString();
        
        UserDetails userDetails = userDetailsService.loadUserByUsername(username);
        
        if (passwordEncoder.matches(password, userDetails.getPassword())) {
            return new UsernamePasswordAuthenticationToken(
                    userDetails, password, userDetails.getAuthorities());
        } else {
            throw new BadCredentialsException("Invalid credentials");
        }
    }
    
    @Override
    public boolean supports(Class<?> authentication) {
        return authentication.equals(UsernamePasswordAuthenticationToken.class);
    }
}</code></pre>
                        </div>
                    </div>
                </section>

                <section id="jwt" class="section">
                    <h2>üé´ JWT Security</h2>
                    
                    <div class="subsection">
                        <h3>JWT Implementation</h3>
                        <div class="code-block">
                            <pre><code>@Component
public class JwtTokenProvider {
    
    @Value("${app.jwt.secret}")
    private String jwtSecret;
    
    @Value("${app.jwt.expiration}")
    private int jwtExpirationInMs;
    
    public String generateToken(Authentication authentication) {
        UserPrincipal userPrincipal = (UserPrincipal) authentication.getPrincipal();
        Date expiryDate = new Date(System.currentTimeMillis() + jwtExpirationInMs);
        
        return Jwts.builder()
                .setSubject(Long.toString(userPrincipal.getId()))
                .setIssuedAt(new Date())
                .setExpiration(expiryDate)
                .signWith(SignatureAlgorithm.HS512, jwtSecret)
                .compact();
    }
    
    public Long getUserIdFromJWT(String token) {
        Claims claims = Jwts.parser()
                .setSigningKey(jwtSecret)
                .parseClaimsJws(token)
                .getBody();
        
        return Long.parseLong(claims.getSubject());
    }
    
    public boolean validateToken(String authToken) {
        try {
            Jwts.parser().setSigningKey(jwtSecret).parseClaimsJws(authToken);
            return true;
        } catch (SignatureException ex) {
            logger.error("Invalid JWT signature");
        } catch (MalformedJwtException ex) {
            logger.error("Invalid JWT token");
        } catch (ExpiredJwtException ex) {
            logger.error("Expired JWT token");
        } catch (UnsupportedJwtException ex) {
            logger.error("Unsupported JWT token");
        } catch (IllegalArgumentException ex) {
            logger.error("JWT claims string is empty");
        }
        return false;
    }
}

@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    
    @Autowired
    private JwtTokenProvider tokenProvider;
    
    @Autowired
    private CustomUserDetailsService customUserDetailsService;
    
    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                  HttpServletResponse response, 
                                  FilterChain filterChain) throws ServletException, IOException {
        try {
            String jwt = getJwtFromRequest(request);
            
            if (StringUtils.hasText(jwt) && tokenProvider.validateToken(jwt)) {
                Long userId = tokenProvider.getUserIdFromJWT(jwt);
                
                UserDetails userDetails = customUserDetailsService.loadUserById(userId);
                UsernamePasswordAuthenticationToken authentication = 
                    new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
                authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
                
                SecurityContextHolder.getContext().setAuthentication(authentication);
            }
        } catch (Exception ex) {
            logger.error("Could not set user authentication in security context", ex);
        }
        
        filterChain.doFilter(request, response);
    }
    
    private String getJwtFromRequest(HttpServletRequest request) {
        String bearerToken = request.getHeader("Authorization");
        if (StringUtils.hasText(bearerToken) && bearerToken.startsWith("Bearer ")) {
            return bearerToken.substring(7);
        }
        return null;
    }
}</code></pre>
                        </div>
                    </div>
                </section>

                <section id="interview" class="section">
                    <h2>üíº Interview Questions</h2>
                    
                    <div class="subsection">
                        <h3>Frequently Asked Questions</h3>
                        
                        <div class="question-block">
                            <h4>Q1: What is the difference between authentication and authorization?</h4>
                            <p><strong>Answer:</strong></p>
                            <ul>
                                <li><strong>Authentication:</strong> Verifying user identity (who you are)</li>
                                <li><strong>Authorization:</strong> Controlling access to resources (what you can do)</li>
                                <li><strong>Example:</strong> Login verifies identity, role determines access level</li>
                            </ul>
                        </div>
                        
                        <div class="question-block">
                            <h4>Q2: How does Spring Security filter chain work?</h4>
                            <p><strong>Answer:</strong> Spring Security uses a chain of filters to process requests. Each filter handles specific security concerns like authentication, authorization, CSRF protection, etc. Filters are ordered and process requests sequentially.</p>
                        </div>
                        
                        <div class="question-block">
                            <h4>Q3: What is JWT and how is it used in Spring Security?</h4>
                            <p><strong>Answer:</strong> JWT (JSON Web Token) is a stateless authentication mechanism. Contains encoded user information and signature. Used for API authentication, eliminates need for server-side sessions.</p>
                        </div>
                        
                        <div class="question-block">
                            <h4>Q4: How do you implement method-level security?</h4>
                            <p><strong>Answer:</strong> Use @EnableGlobalMethodSecurity and annotations like @PreAuthorize, @PostAuthorize, @Secured, @RolesAllowed on methods to control access based on user roles or custom expressions.</p>
                        </div>
                        
                        <div class="question-block">
                            <h4>Q5: What is CSRF and how does Spring Security handle it?</h4>
                            <p><strong>Answer:</strong> CSRF (Cross-Site Request Forgery) is an attack where unauthorized commands are transmitted from a user. Spring Security provides CSRF tokens to validate legitimate requests from trusted sources.</p>
                        </div>
                    </div>
                </section>

            </div>
            </div>
        </div>
    </div>
    
    <script src="../footer.js"></script>
</body>
</html>